# 数据记录功能使用说明

## 概述

本功能将原来在控制台中打印的 observation、raw action 和 action 数据保存到 CSV 文件中，便于后续分析和处理。

## 功能特点

1. **自动文件命名**: 数据文件会自动添加时间戳，避免覆盖之前的数据
2. **分离存储**: 观察数据、原始动作数据和处理后动作数据分别存储在不同的文件中
3. **CSV格式**: 使用标准的CSV格式，便于在Excel、Python等工具中分析
4. **数据分析脚本**: 提供Python脚本用于数据可视化和统计分析

## 生成的文件

运行程序后，会在当前目录下生成以下文件：

- `robot_data_YYYY-MM-DD_HH-MM-SS_observation.csv`: 观察数据文件
- `robot_data_YYYY-MM-DD_HH-MM-SS_raw_action.csv`: 原始动作数据文件  
- `robot_data_YYYY-MM-DD_HH-MM-SS_action.csv`: 处理后动作数据文件

## 文件格式

### 观察数据文件 (observation.csv)
- 包含65列数据（obs_0 到 obs_64）
- 每行包含一个时间戳和对应的观察数据
- 数据来自机器人的传感器状态

### 原始动作数据文件 (raw_action.csv)
- 包含12列数据（raw_action_0 到 raw_action_11）
- 每行包含一个时间戳和对应的原始动作数据
- 数据来自神经网络的直接输出

### 处理后动作数据文件 (action.csv)
- 包含12列数据（action_0 到 action_11）
- 每行包含一个时间戳和对应的处理后动作数据
- 数据经过缩放等处理后用于机器人控制

## 使用方法

### 1. 编译程序

```bash
./build.sh
```

### 2. 运行程序

```bash
./Lite_motion [gRPC服务器地址]
```

程序运行时会自动创建数据记录器并开始保存数据。

### 3. 分析数据

使用提供的Python脚本分析数据：

```bash
cd scripts
python3 analyze_data.py [基础文件名]
```

如果不指定基础文件名，默认使用 "robot_data"。

## 数据分析脚本功能

`scripts/analyze_data.py` 脚本提供以下功能：

1. **自动加载数据**: 自动查找并加载最新的数据文件
2. **统计信息**: 显示数据的基本统计信息（数据点数量、时间范围、数值范围等）
3. **数据可视化**: 生成观察数据和动作数据的拼接图表
4. **按分类显示**: 将65维observation数据按8个分类进行可视化，同一分类内使用不同颜色区分
5. **动作数据整合**: 将所有12个关节的动作数据绘制在一张图表上，按腿部使用不同颜色
6. **图片保存**: 自动保存拼接分析图表为PNG文件

### 依赖库

运行分析脚本需要安装以下Python库：

```bash
pip install pandas matplotlib numpy
```

### 生成的文件

运行分析脚本后会生成以下文件：
- `combined_analysis.png`: 拼接的分析图表，包含所有observation数据和动作数据

## 数据示例

### 观察数据示例
```csv
timestamp,obs_0,obs_1,obs_2,...,obs_64
10000,0.123456,0.234567,0.345678,...,0.987654
10020,0.124567,0.235678,0.346789,...,0.988765
...
```

### 动作数据示例
```csv
timestamp,raw_action_0,raw_action_1,...,raw_action_11
10000,0.123456,0.234567,...,0.987654
10020,0.124567,0.235678,...,0.988765
...
```

## 注意事项

1. **文件大小**: 长时间运行可能会生成较大的数据文件，请注意磁盘空间
2. **数据完整性**: 程序正常退出时会自动关闭数据记录器，确保数据完整性
3. **时间戳**: 时间戳使用程序内部的 tick 计数，不是真实时间
4. **数据频率**: 数据记录频率为50Hz（每20个tick记录一次）

## 故障排除

### 问题1: 无法创建数据文件
- 检查当前目录的写入权限
- 确保磁盘空间充足

### 问题2: 分析脚本无法运行
- 确保已安装所需的Python库
- 检查数据文件是否存在

### 问题3: 数据文件为空
- 检查程序是否正常运行到神经网络推理阶段
- 确认时间戳是否达到10000以上

## 扩展功能

如需添加更多数据记录功能，可以：

1. 在 `DataLogger` 类中添加新的保存方法
2. 在 `main.cpp` 中调用相应的保存方法
3. 更新分析脚本以处理新的数据格式 